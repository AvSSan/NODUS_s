# üîÑ Real-time Sync - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üìã –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ —Ä–µ—à–µ–Ω–∏—è—Ö

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 1: –†–µ–∞–∫—Ü–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°—Ç–∞—Ç—É—Å:** üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–û (Frontend)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë WebSocket —Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, —Ä–µ–∞–∫—Ü–∏—è –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
- Backend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–æ–±—ã—Ç–∏—è `reaction.added` –∏ `reaction.removed`
- Frontend **–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª** —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è –≤ `useRealtimeSubscriptions`

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ WebSocket —Å–æ–±—ã—Ç–∏–π:

```typescript
// src/hooks/useRealtimeSubscriptions.ts

const handleReactionAdded = ({ chatId, reaction }) => {
  // –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –≤ –∫—ç—à–µ
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (emoji + user_id)
};

const handleReactionRemoved = ({ chatId, reaction }) => {
  // –£–¥–∞–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫—ç—à–µ
  // –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ emoji + user_id
};

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
apiAdapter.on('reaction:added', handleReactionAdded);
apiAdapter.on('reaction:removed', handleReactionRemoved);
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –±—Ä–∞—É–∑–µ—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë —Ä–µ–∞–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 3: –†–µ–∞–∫—Ü–∏–∏ –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–û (Frontend)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ù–∞ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, üëç ‚ù§Ô∏è)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ (–º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç)
- –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏ **–∏—Å—á–µ–∑–∞—é—Ç**

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–ª —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–µ –æ—Ç API
- Backend –º–æ–∂–µ—Ç –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `reactions` –≤ –æ—Ç–≤–µ—Ç–µ –Ω–∞ PATCH –∑–∞–ø—Ä–æ—Å
- –†–µ–∞–∫—Ü–∏–∏ —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –∑–∞–º–µ–Ω–µ

**–†–µ—à–µ–Ω–∏–µ:**
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `useUpdateMessageMutation` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π:

```typescript
// src/hooks/useMessages.ts

onSuccess: (updatedMessage) => {
  messages.map((msg) => {
    if (msg.id === updatedMessage.id) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º reactions –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      const reactions = (updatedMessage.reactions?.length > 0)
        ? updatedMessage.reactions
        : msg.reactions || [];
      
      return {
        ...updatedMessage,
        reactions, // ‚úÖ –†–µ–∞–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
      };
    }
    return msg;
  });
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç)
3. –†–µ–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã **–æ—Å—Ç–∞—Ç—å—Å—è** –Ω–∞ –º–µ—Å—Ç–µ

---

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:** üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–û (Backend)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —É–¥–∞–ª—è–µ—Ç —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ë
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë —á–∞—Ç **–ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è**, –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–ü—Ä–∏—á–∏–Ω–∞:**
- Backend **–ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–ª** WebSocket —Å–æ–±—ã—Ç–∏–µ `chat.deleted` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞
- Frontend –Ω–µ –º–æ–≥ —É–∑–Ω–∞—Ç—å –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–†–µ—à–µ–Ω–∏–µ (Backend):**

Backend –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω - —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `chat.deleted`:

```python
# app/services/chat.py

async def delete_chat(self, chat: Chat, deleted_by: int) -> None:
    """–£–¥–∞–ª–∏—Ç—å —á–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å WebSocket —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º"""
    chat_id = chat.id
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –î–û —É–¥–∞–ª–µ–Ω–∏—è
    participant_ids = await self.members.list_participant_ids(chat_id)
    
    # –£–¥–∞–ª—è–µ–º —á–∞—Ç
    await self.session.delete(chat)
    await self.session.commit()
    
    # ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º WebSocket —Å–æ–±—ã—Ç–∏–µ
    if self.redis:
        await self._publish_chat_deleted_event(chat_id, deleted_by, participant_ids)

async def _publish_chat_deleted_event(
    self, chat_id: int, deleted_by: int, participant_ids: list[int]
) -> None:
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º"""
    payload = {
        "event": "chat.deleted",
        "data": {
            "id": chat_id,
            "deleted_by": deleted_by,
        },
    }
    # –ü—É–±–ª–∏–∫—É–µ–º –≤ Redis –∫–∞–Ω–∞–ª—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

**–§–æ—Ä–º–∞—Ç WebSocket —Å–æ–±—ã—Ç–∏—è:**
```json
{
  "event": "chat.deleted",
  "data": {
    "id": 6,
    "deleted_by": 3
  }
}
```

**Frontend –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
```typescript
// –í useRealtimeSubscriptions
const handleChatDeleted = ({ id }: { id: number }) => {
  queryClient.setQueryData<Chat[]>(['chats'], (old) => {
    if (!old) return old;
    return old.filter((chat) => chat.id !== id);
  });
  
  // –ï—Å–ª–∏ –º—ã –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–º —á–∞—Ç–µ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
  if (currentChatId === id) {
    navigate('/chats');
  }
};

apiAdapter.on('chat:deleted', handleChatDeleted);
```

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `app/services/chat.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `app/api/v1/chats.py` - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `redis` –∏ `deleted_by`
- ‚úÖ `FRONTEND_INTEGRATION_GUIDE.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `BACKEND_FIX_CHAT_DELETED.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π | –î–µ–π—Å—Ç–≤–∏—è |
|----------|--------|--------------|----------|
| 1. –†–µ–∞–∫—Ü–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | Frontend | –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `reaction:added/removed` |
| 2. –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | Backend + Frontend | Backend –¥–æ–±–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–µ `chat.deleted`, Frontend –¥–æ–±–∞–≤–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ |
| 3. –†–µ–∞–∫—Ü–∏–∏ –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | Frontend | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ reactions –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ |

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `message.deleted`
–¢–∞–∫–∂–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω —è–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–±—ã—Ç–∏—è `message.deleted`:

```typescript
const handleMessageDeleted = ({ chatId, message }) => {
  // –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫—ç—à–µ, –ø–æ–º–µ—á–∞—è –µ–≥–æ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç is_deleted: true, deleted_at
};
```

–≠—Ç–æ —É–ª—É—á—à–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## üß™ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–∞–∫—Ü–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤ –¥–≤—É—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –∏ –ë)
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–∫—Ü–∏—é üëç
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –£ –ë –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è üëç
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —É–±–∏—Ä–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –£ –ë –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –∏—Å—á–µ–∑–∞–µ—Ç üëç

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–∫—Ü–∏—è–º–∏
1. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏: üëç ‚ù§Ô∏è üòÇ
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –í—Å–µ 3 —Ä–µ–∞–∫—Ü–∏–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ –º–µ—Å—Ç–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ ‚úÖ
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê —É–¥–∞–ª—è–µ—Ç —á–∞—Ç —Å –ë
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –£ –ë —á–∞—Ç –∏—Å—á–µ–∑–∞–µ—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
3. WebSocket —Å–æ–±—ã—Ç–∏–µ `chat.deleted` –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### Frontend
- ‚úÖ `src/hooks/useRealtimeSubscriptions.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏—è
- ‚úÖ `src/hooks/useMessages.ts` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ reactions –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- ‚è≥ `src/hooks/useRealtimeSubscriptions.ts` - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `chat:deleted`

### Backend
- ‚úÖ `app/services/chat.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ WebSocket —Å–æ–±—ã—Ç–∏—è `chat.deleted`
- ‚úÖ `app/api/v1/chats.py` - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `redis` –∏ `deleted_by`
- ‚úÖ `FRONTEND_INTEGRATION_GUIDE.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `BACKEND_FIX_CHAT_DELETED.md` - —Å–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç

---

**–ê–≤—Ç–æ—Ä—ã:** Frontend Team + Backend Team  
**–î–∞—Ç–∞:** 2025-11-05  
**–í–µ—Ä—Å–∏–∏:** Frontend v2.0 + Backend v2.1

---

## üéØ –ò—Ç–æ–≥ –æ—Ç Backend Team

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ #2 –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—ç–∫–µ–Ω–¥–∞**

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ WebSocket —Å–æ–±—ã—Ç–∏—è `chat.deleted` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞
2. –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —á–∞—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `FRONTEND_INTEGRATION_GUIDE.md`
4. –°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç `BACKEND_FIX_CHAT_DELETED.md`

### –§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è:
```json
{
  "event": "chat.deleted",
  "data": {
    "id": 6,
    "deleted_by": 3
  }
}
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É:
–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `useRealtimeSubscriptions.ts`:
```typescript
apiAdapter.on('chat:deleted', ({ id }) => {
  queryClient.setQueryData<Chat[]>(['chats'], (old) => 
    old?.filter(chat => chat.id !== id)
  );
});
```

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. —Ñ–∞–π–ª `BACKEND_FIX_CHAT_DELETED.md`
